<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | Tasks Tracker</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <h1>ğŸ“‹ Tasks Dashboard</h1>
  <div id="message"></div>

  <!-- ğŸ” Search Input -->
  <div style="display: flex; justify-content: center; margin: 20px 0; gap: 10px; flex-wrap: wrap;">
    <input
      type="text"
      id="taskSearch"
      placeholder="Search tasks by title..."
      style="padding: 10px 14px; border-radius: 8px; border: 1px solid #D1D5DB; width: 100%; max-width: 400px; font-size: 1rem;"
    />

    <!-- ğŸ”½ Priority Filter -->
    <select id="priorityFilter" style="padding: 10px 14px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 1rem; max-width: 200px; width: 100%;">
      <option value="">Filter by Priority</option>
      <option value="High">ğŸ”¥ High</option>
      <option value="Medium">âš¡ Medium</option>
      <option value="Low">ğŸ§Š Low</option>
    </select>
  </div>

  <!-- âœ… Task Creation Form -->
  <form id="taskForm">
    <input type="text" name="title" placeholder="Task title" required>
    <input type="date" name="due_date" required>
    <select name="priority" required>
      <option value="High">High</option>
      <option value="Medium">Medium</option>
      <option value="Low">Low</option>
    </select>
    <button type="submit">â• Add Task</button>
  </form>

  <!-- âœ… Task List -->
  <ul id="taskList"></ul>

  <script>
    const taskForm = document.getElementById("taskForm");
    const taskList = document.getElementById("taskList");
    const message = document.getElementById("message");
    const searchInput = document.getElementById("taskSearch");
    const priorityFilter = document.getElementById("priorityFilter");

    let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");

    function showMessage(text, type = "success") {
      message.textContent = text;
      message.className = type;
      setTimeout(() => (message.textContent = ""), 3000);
    }

    function saveTasks() {
      localStorage.setItem("tasks", JSON.stringify(tasks));
    }

    function renderTasks() {
      taskList.innerHTML = "";
      const query = searchInput.value.toLowerCase();
      const selectedPriority = priorityFilter.value.toLowerCase();

      tasks.forEach((task, index) => {
        const titleMatch = task.title.toLowerCase().includes(query);
        const priorityMatch = !selectedPriority || task.priority.toLowerCase() === selectedPriority;
        if (!(titleMatch && priorityMatch)) return;

        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${task.title}</strong>
          <p class="priority" data-priority="${task.priority}">Priority: ${task.priority}</p>
          <p>Due: ${task.due_date}</p>
          <div>
            <button onclick="editTask(${index})">âœï¸ Edit</button>
            <button onclick="deleteTask(${index})">ğŸ—‘ï¸ Delete</button>
          </div>
        `;
        taskList.appendChild(li);
      });
    }

    function deleteTask(index) {
      tasks.splice(index, 1);
      saveTasks();
      renderTasks();
      showMessage("Task deleted.", "success");
    }

    function editTask(index) {
      const task = tasks[index];
      taskForm.title.value = task.title;
      taskForm.due_date.value = task.due_date;
      taskForm.priority.value = task.priority;
      taskForm.dataset.editIndex = index;
    }

    taskForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const newTask = {
        title: this.title.value,
        due_date: this.due_date.value,
        priority: this.priority.value
      };

      const editIndex = this.dataset.editIndex;
      if (editIndex !== undefined) {
        tasks[editIndex] = newTask;
        delete this.dataset.editIndex;
        showMessage("Task updated successfully.", "success");
      } else {
        tasks.push(newTask);
        showMessage("Task added successfully.", "success");
      }

      saveTasks();
      renderTasks();
      this.reset();
    });

    searchInput.addEventListener("keyup", renderTasks);
    priorityFilter.addEventListener("change", renderTasks);

    renderTasks();
  </script>
</body>
</html>
